name: Full CI

on:
  push:
    branches: [main]
  pull_request:

jobs:
  test-python:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Python
        uses: actions/setup-python@v4
        with: python-version: '3.10'
      - name: Install deps
        run: pip install sympy pint emcee arviz rebound toml
      - name: Run analysis scripts
        run: |
          python scripts/mtheory_r4_fit.py -N 16 -d 5 -t 1e-2
          python scripts/scan_hidden_photon_refined_pickle.py

  build-lean:
    runs-on: ubuntu-latest
    needs: test-python
    steps:
      - uses: actions/checkout@v3
      - name: Setup Lean + Lake
        uses: leanprover/lean4-action@v1
        with:
          lean-version: latest
      - name: Build Lean project
        working-directory: photon_project_formal
        run: lake build --verbose
